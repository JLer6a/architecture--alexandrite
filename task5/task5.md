# Архитектурное решение по кешированию
## Мотивация
### В системе «Александрит» наблюдаются следующие проблемы:
      - Низкая скорость загрузки страницы MES: операторы долго ожидают загрузки списка заказов.
      - Долгое время расчёта стоимости заказа: иногда до 30 минут, особенно при высокой детализации модели.
      - Рост количества заказов и API-запросов приводит к увеличению нагрузки на базу данных MES и просадкам по производительности.
### Внедрение кеширования поможет:
      - Уменьшить количество обращений к базе данных MES.
      - Снизить нагрузку на API MES при массовых запросах от внешних клиентов.
      - Ускорить отклик интерфейса MES и увеличить удовлетворённость операторов.
      - Избежать повторных дорогостоящих расчётов стоимости одного и того же изделия, если модель не изменилась.
### Элементы системы, которые стоит кешировать:
      - Список заказов (с фильтрацией и пагинацией) на дашборде MES.
      - Результаты расчёта стоимости 3D-модели.
      - Часто запрашиваемую справочную информацию (статусы, типы операций и др.).


# Предлагаемое решение
## Тип кеширования
### Серверное кеширование:
      - Используется для данных, которые часто читаются многими пользователями, но редко меняются.
      - Уместно для данных заказов в MES и результатов расчёта стоимости моделей.
## Клиентское кеширование:
      - Применимо для временного хранения справочной информации (например, фильтров и статусов) на фронтенде MES и CRM, чтобы не дергать API.

#### Выбранные паттерны кеширования
1. Список заказов (дашборд MES) --- Cache-Aside	
Наиболее гибкий и простой способ. Кеш актуализируется только при обращении.
2. Расчёт стоимости 3D-модели --- Write-Through
Результат кешируется сразу после вычисления. Обеспечивает консистентность.
3. Справочная информация --- Refresh-Ahead
Обновляется заранее по расписанию, минимизируя просадку при первом запросе.

#### Не выбрал патерны из-за:
      - Write-Behind: увеличивает риск потери данных при сбоях — не подходит для чувствительных заказов.
      - Only-Cache: небезопасен — потеря кеша приведёт к полной остановке части логики.


# Диаграмма последовательности
[Диаграмма последовательности](диаграмма-последовательности.puml)


# Стратегия инвалидации кеша
1. Список заказов --- Стратегия "По ключу" и "временная"
Инвалидация по ключу при изменении данных. TTL (5 мин) на случай, если событие не отработало.

2. Расчёт стоимости модели	--- Стратегия "По ключу" (модель+hash)
Уникальный хеш от 3D-файла. Инвалидация при новой загрузке файла.

3. Справочные данные	--- Стратегия "Временная (TTL)"
Автоматическое обновление раз в 24 часа. При изменении — программная.
